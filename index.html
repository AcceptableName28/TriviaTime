<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pauline vs Jon: Trivia Ultimate</title>
    <style>
        :root {
            --p1-color: #8e44ad; /* Pauline (Purple) */
            --p2-color: #2980b9; /* Jon (Blue) */
            --bg-color: #2c3e50;
            --card-bg: #ecf0f1;
            --accent: #f1c40f;
            --text: #2c3e50;
        }

        * { box-sizing: border-box; touch-action: manipulation; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LAYOUT GRID --- */
        .game-container {
            display: grid;
            grid-template-rows: 60px 1fr 160px; /* Header | Card | Controls */
            height: 100%;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        /* --- HEADER (SCORES) --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            background: rgba(0,0,0,0.2);
            color: white;
        }
        
        .score-box {
            text-align: center;
            min-width: 70px;
        }
        .score-val { font-size: 1.8rem; font-weight: 800; line-height: 1; }
        .score-name { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }
        
        .round-info {
            font-size: 0.8rem;
            opacity: 0.6;
            text-align: center;
        }

        /* --- MAIN CARD AREA --- */
        .card-area {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
            overflow-y: auto;
        }

        .category-tag {
            background: #95a5a6;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-bottom: 15px;
            position: absolute;
            top: 20px;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .answer-box {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 10px;
            width: 90%;
            font-size: 1.2rem;
            font-weight: bold;
            opacity: 0; /* Hidden by default but takes up space */
            transition: opacity 0.3s;
        }
        .answer-box.visible { opacity: 1; }

        /* --- TIMER --- */
        .timer-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
        }
        .timer-fill {
            height: 100%;
            width: 100%;
            background: var(--accent);
            transition: width 1s linear;
        }

        /* --- CONTROLS (FIXED BOTTOM) --- */
        .controls-area {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* BUZZER ROW */
        .buzzer-row {
            display: flex;
            gap: 10px;
            flex: 1;
        }
        
        .buzzer-btn {
            flex: 1;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
            cursor: pointer;
            position: relative;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        
        .btn-pauline { background-color: var(--p1-color); }
        .btn-jon { background-color: var(--p2-color); }

        .buzzer-btn:active { transform: translateY(4px); box-shadow: none; }
        
        /* Locked State */
        .controls-area.locked .buzzer-btn { opacity: 0.3; pointer-events: none; }
        .controls-area.locked .buzzer-btn.winner { opacity: 1; transform: scale(1.02); box-shadow: 0 0 15px white; }

        /* ADMIN ROW */
        .admin-row {
            display: flex;
            gap: 10px;
            height: 50px;
            opacity: 0.3; /* Dimmed until buzzer pressed */
            pointer-events: none; /* Disabled until buzzer */
        }
        .controls-area.active-admin .admin-row { opacity: 1; pointer-events: all; }

        .btn-admin {
            flex: 1;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
        }
        .btn-correct { background: #27ae60; }
        .btn-wrong { background: #c0392b; }
        .btn-skip { background: #7f8c8d; }

        /* LOADING SPINNER */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="game-container">
        <div class="header">
            <div class="score-box">
                <div class="score-val" id="score-p1">0</div>
                <div class="score-name" style="color: #d2b4de;">Pauline</div>
            </div>
            
            <div class="round-info">
                <div id="mode-text">MIXED MODE</div>
                <div class="loader" id="loader"></div>
            </div>

            <div class="score-box">
                <div class="score-val" id="score-p2">0</div>
                <div class="score-name" style="color: #a9cce3;">Jon</div>
            </div>
        </div>

        <div class="card-area">
            <div class="card">
                <div class="timer-track"><div class="timer-fill" id="timer"></div></div>
                <div class="category-tag" id="category">Loading...</div>
                
                <div class="question-text" id="question">
                    Press "Next" to start the game!
                </div>

                <div class="answer-box" id="answer">
                    ANSWER HIDDEN
                </div>
            </div>
        </div>

        <div class="controls-area" id="controls-area">
            <div class="buzzer-row">
                <button class="buzzer-btn btn-pauline" id="btn-p1" onclick="handleBuzz(1)">PAULINE</button>
                <button class="buzzer-btn btn-jon" id="btn-p2" onclick="handleBuzz(2)">JON</button>
            </div>

            <div class="admin-row">
                <button class="btn-admin btn-correct" onclick="judge(true)">Correct (+1)</button>
                <button class="btn-admin btn-wrong" onclick="judge(false)">Wrong (0)</button>
                <button class="btn-admin btn-skip" onclick="nextQuestion()">Next &rarr;</button>
            </div>
        </div>
    </div>

    <script>
        /* --- CONFIGURATION & DATA --- 
           To add more Custom questions, just add to the 'customQuestions' array below.
           For general trivia, the game fetches from OpenTriviaDB automatically.
        */
        
        const customQuestions = [
            // FRIENDS
            {cat:"Friends", q:"What is the name of Joey's bedtime penguin?", a:"Hugsy"},
            {cat:"Friends", q:"What name does Phoebe use as her alter ego?", a:"Regina Phalange"},
            {cat:"Friends", q:"What is Chandler Bing's middle name?", a:"Muriel"},
            {cat:"Friends", q:"Which sister did Chandler kiss before dating Monica?", a:"Mary Angela (Joey's sister)"},
            {cat:"Friends", q:"What is the address Chandler goes to in Yemen?", a:"15 Yemen Road, Yemen"},
            // HIMYM
            {cat:"HIMYM", q:"What instrument does Ted steal for Robin?", a:"Blue French Horn"},
            {cat:"HIMYM", q:"What is the name of the bar the gang hangs out at?", a:"MacLaren's"},
            {cat:"HIMYM", q:"What is Barney's job title acronym?", a:"PLEASE"},
            // STAR WARS
            {cat:"Star Wars", q:"Who is the only non-Jedi in the original trilogy to use a lightsaber?", a:"Han Solo (Empire Strikes Back)"},
            {cat:"Star Wars", q:"What species is Admiral Ackbar?", a:"Mon Calamari"},
            {cat:"Star Wars", q:"What is the name of Boba Fett's ship?", a:"Slave I"},
            // 90s
            {cat:"90s TV", q:"Who loves Orange Soda in 'Kenan & Kel'?", a:"Kel loves Orange Soda"},
            {cat:"90s Toys", q:"Which 90s toy was a furry robotic creature that spoke Furbish?", a:"Furby"},
            {cat:"90s Music", q:"Who sang 'Genie in a Bottle'?", a:"Christina Aguilera"}
        ];

        // --- STATE VARIABLES ---
        let currentQ = null;
        let p1Score = 0;
        let p2Score = 0;
        let buzzWinner = 0; // 0=none, 1=Pauline, 2=Jon
        let timerInterval;
        let seenQuestions = new Set(); // Stores hashes of asked questions to prevent repeats
        let apiToken = null; // Token for OpenTDB to prevent repeats server-side

        // --- DOM ELEMENTS ---
        const ui = {
            q: document.getElementById('question'),
            a: document.getElementById('answer'),
            cat: document.getElementById('category'),
            timer: document.getElementById('timer'),
            p1Score: document.getElementById('score-p1'),
            p2Score: document.getElementById('score-p2'),
            controls: document.getElementById('controls-area'),
            btnP1: document.getElementById('btn-p1'),
            btnP2: document.getElementById('btn-p2'),
            loader: document.getElementById('loader')
        };

        // --- INIT ---
        window.onload = async () => {
            // Get session token from API to ensure no repeats from their end
            try {
                const r = await fetch('https://opentdb.com/api_token.php?command=request');
                const d = await r.json();
                if(d.response_code === 0) apiToken = d.token;
            } catch(e) { console.log("Offline mode"); }
            
            ui.q.innerText = "Ready? Tap Next to Start!";
        };

        // --- GAME ENGINE ---
        
        async function nextQuestion() {
            // 1. Reset UI
            clearInterval(timerInterval);
            buzzWinner = 0;
            ui.controls.classList.remove('locked');
            ui.controls.classList.remove('active-admin');
            ui.btnP1.classList.remove('winner');
            ui.btnP2.classList.remove('winner');
            ui.a.classList.remove('visible');
            ui.a.innerText = "Loading...";
            ui.loader.style.display = 'block';

            // 2. Get Question (Mix of Local vs API)
            // 30% chance of Custom, 70% chance of API
            const useLocal = Math.random() < 0.3; 
            
            if (useLocal) {
                currentQ = getLocalQuestion();
            } else {
                currentQ = await getApiQuestion();
                // Fallback to local if API fails
                if (!currentQ) currentQ = getLocalQuestion(); 
            }

            // 3. Render
            ui.loader.style.display = 'none';
            ui.cat.innerText = currentQ.cat;
            
            // Decode HTML entities from API (e.g. &quot;)
            const txt = document.createElement("textarea");
            txt.innerHTML = currentQ.q;
            ui.q.innerText = txt.value;
            
            txt.innerHTML = currentQ.a;
            ui.a.innerText = txt.value;

            // 4. Start Timer
            startTimer();
        }

        function getLocalQuestion() {
            // Simple random pick that hasn't been seen
            const available = customQuestions.filter(q => !seenQuestions.has(q.q));
            if (available.length === 0) {
                // Reset local history if exhausted
                return customQuestions[Math.floor(Math.random() * customQuestions.length)];
            }
            const q = available[Math.floor(Math.random() * available.length)];
            seenQuestions.add(q.q);
            return q;
        }

        async function getApiQuestion() {
            try {
                // Categories: 9(Gen), 11(Film), 12(Music), 14(TV), 17(Nature), 18(Computers), 23(History)
                const cats = [9, 11, 12, 14, 17, 18, 23];
                const rndCat = cats[Math.floor(Math.random() * cats.length)];
                
                let url = `https://opentdb.com/api.php?amount=1&category=${rndCat}&type=multiple`;
                if(apiToken) url += `&token=${apiToken}`;

                const response = await fetch(url);
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const item = data.results[0];
                    return {
                        cat: item.category,
                        q: item.question,
                        a: item.correct_answer
                    };
                }
            } catch (error) {
                console.error("API Error", error);
            }
            return null;
        }

        // --- TIMER LOGIC ---
        function startTimer() {
            let timeLeft = 30;
            ui.timer.style.width = '100%';
            
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                ui.timer.style.width = (timeLeft / 30 * 100) + "%";
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    reveal(false); // Time's up, reveal answer, no winner
                }
            }, 100);
        }

        // --- INTERACTION ---
        function handleBuzz(player) {
            if (buzzWinner !== 0) return; // Already buzzed
            
            clearInterval(timerInterval);
            buzzWinner = player;
            
            // UI Locking
            ui.controls.classList.add('locked');
            ui.controls.classList.add('active-admin'); // Enable admin buttons
            
            if (player === 1) ui.btnP1.classList.add('winner');
            else ui.btnP2.classList.add('winner');

            reveal(true);
        }

        function reveal(hasWinner) {
            ui.a.classList.add('visible');
            // If time ran out (hasWinner=false), enable admin controls anyway to allow "Next"
            if (!hasWinner) ui.controls.classList.add('active-admin');
        }

        function judge(correct) {
            if (correct && buzzWinner !== 0) {
                if (buzzWinner === 1) {
                    p1Score++;
                    ui.p1Score.innerText = p1Score;
                } else {
                    p2Score++;
                    ui.p2Score.innerText = p2Score;
                }
                // Visual feedback?
                ui.a.style.background = "#2ecc71"; // Brighter green
            } else if (!correct) {
                ui.a.style.background = "#e74c3c"; // Red background on wrong
            }

            // Small delay then reset background for next question
            setTimeout(() => {
                ui.a.style.background = "#27ae60"; 
            }, 500);
            
            // Wait for user to hit "Next" explicitly
        }

    </script>
</body>
</html>