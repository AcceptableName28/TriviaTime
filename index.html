<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pauline & Jon Trivia</title>
  <style>
    :root { --gap: 12px; --radius: 14px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#0b0f19; color:#eef2ff; }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 18px; }
    h1 { margin: 6px 0 12px; font-size: 22px; letter-spacing: .2px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: var(--gap); }
    @media (min-width: 940px){ .grid { grid-template-columns: 1.18fr .82fr; } }
    .card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: var(--radius); padding: 14px; backdrop-filter: blur(6px); }
    .row { display:flex; flex-wrap: wrap; gap: 10px; align-items:center; }
    label { font-size: 12px; opacity: .85; display:block; margin-bottom:6px; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25); color: #eef2ff;
    }
    select {
      padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25); color: #eef2ff;
    }
    button {
      padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10); color: #eef2ff; cursor: pointer;
    }
    button:hover { background: rgba(255,255,255,0.16); }
    button.primary { background: rgba(99,102,241,0.35); border-color: rgba(99,102,241,0.5); }
    button.primary:hover { background: rgba(99,102,241,0.5); }
    button.danger { background: rgba(239,68,68,0.25); border-color: rgba(239,68,68,0.35); }
    button.danger:hover { background: rgba(239,68,68,0.35); }
    button.good { background: rgba(34,197,94,0.22); border-color: rgba(34,197,94,0.32); }
    button.good:hover { background: rgba(34,197,94,0.32); }
    button.gold { background: rgba(245,158,11,0.22); border-color: rgba(245,158,11,0.32); }
    button.gold:hover { background: rgba(245,158,11,0.32); }

    .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.16); font-size: 12px; opacity:.95; }
    .muted { opacity:.8; }
    .bigQ { font-size: 20px; line-height: 1.25; margin: 8px 0 6px; }
    .ansBox { margin-top: 10px; padding: 10px 12px; border-radius: 12px; border: 1px dashed rgba(255,255,255,0.25); background: rgba(0,0,0,0.25); }
    .hidden { display:none; }

    .scoreGrid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .scoreBox { padding: 12px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.22); }
    .scoreName { font-weight: 700; font-size: 14px; }
    .scoreNum { font-size: 36px; font-weight: 800; margin-top: 2px; }
    .tapHint { font-size: 12px; opacity: .8; margin-top: 4px; }

    .awardRow button { flex: 1 1 140px; }
    .divider { height:1px; background: rgba(255,255,255,0.12); margin: 10px 0; }
    .mini { font-size: 12px; opacity: .85; }
    .turnTag { font-weight:700; }

    .timer {
      display:flex; gap: 10px; align-items:center; flex-wrap: wrap;
      padding: 10px; border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.20);
      margin-top: 10px;
    }
    .timeBubble {
      padding: 8px 12px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      font-weight: 900; letter-spacing: .4px;
      min-width: 92px; text-align:center;
    }
    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 16px; padding: 10px 12px; border-radius: 12px;
      background: rgba(0,0,0,0.75); border: 1px solid rgba(255,255,255,0.18);
      max-width: 92vw; z-index: 9999; display:none;
    }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; padding: 2px 6px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.16); opacity:.95;}
    .banner {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(99,102,241,0.15);
      margin-top: 10px;
    }
    .banner strong { font-weight: 900; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Trivia Night üéÆ</h1>

    <div class="grid">
      <div class="card" id="qCard">
        <div class="row" style="justify-content: space-between;">
          <div class="row">
            <span class="pill" id="catPill">Category</span>
            <span class="pill muted">#<span id="qIndex">0</span>/<span id="qTotal">0</span></span>
            <span class="pill muted" id="mixPill">Mix: All</span>
            <span class="pill" id="matchPill">Match: OFF</span>
          </div>
          <div class="row">
            <span class="pill">Turn: <span class="turnTag" id="turnName">‚Äî</span></span>
            <span class="pill" id="pointValuePill">Point: 1</span>
          </div>
        </div>

        <div class="banner hidden" id="matchBanner">
          <div><strong>Best of 10 Match Mode</strong></div>
          <div class="mini muted" id="matchStatus">First to 6 points wins (or highest after 10 questions).</div>
        </div>

        <div class="bigQ" id="questionText">Press ‚ÄúNext Question‚Äù to begin.</div>

        <div class="row">
          <button class="primary" id="nextBtn">Next Question</button>
          <button id="showAnsBtn">Show Answer</button>
          <button id="toggleModeBtn">Mode: Take Turns</button>
          <button id="passBtn">Pass Turn</button>
        </div>

        <div class="timer">
          <div class="timeBubble"><span id="timeLeft">‚Äî</span>s</div>
          <button class="good" id="startTimerBtn">Start Timer</button>
          <button id="stopTimerBtn">Stop</button>
          <button id="buzzerBtn" class="danger">Buzzer</button>

          <div style="flex: 1 1 220px;">
            <label style="margin:0 0 4px;">Seconds per question</label>
            <input type="number" id="secondsInput" min="3" max="120" value="15" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button id="lightningBtn" class="gold">‚ö° Lightning Round: OFF</button>
          <button id="forceLightningBtn">‚ö° Next = Lightning</button>
        </div>

        <div class="ansBox hidden" id="answerBox">
          <div class="mini muted">Answer:</div>
          <div id="answerText" style="font-size:16px; margin-top:4px;"></div>
          <div class="divider"></div>
          <div class="mini">Award <span id="awardPointsLabel">1</span> point(s):</div>
          <div class="row awardRow" style="margin-top:8px;">
            <button id="awardP1">Player 1</button>
            <button id="awardP2">Player 2</button>
            <button class="danger" id="awardNone">No one answered correctly</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content: space-between;">
          <div class="pill">Players & Settings</div>
          <button id="resetBtn" class="danger">Reset</button>
        </div>

        <div class="divider"></div>

        <div class="row" style="gap: 12px;">
          <div style="flex:1 1 220px;">
            <label>Player 1</label>
            <input type="text" id="p1Name" value="Pauline" />
          </div>
          <div style="flex:1 1 220px;">
            <label>Player 2</label>
            <input type="text" id="p2Name" value="Jon" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div style="flex:1 1 260px;">
            <label>Question Mix</label>
            <select id="mixSelect">
              <option value="all" selected>All (90s + TV + Pop + SW + ST + Random + Basic + Funny)</option>
              <option value="tv">TV Shows Only</option>
              <option value="friends">Friends Only</option>
              <option value="himym">HIMYM Only</option>
              <option value="90s">90s Only</option>
              <option value="pop">Pop Culture Only</option>
              <option value="sw">Star Wars Only</option>
              <option value="st">Star Trek Only</option>
              <option value="random">Random Facts Only</option>
              <option value="basic">Basic Knowledge Only</option>
              <option value="funny">Funny Facts Only</option>
            </select>
          </div>
          <div style="flex: 0 0 auto;">
            <label>&nbsp;</label>
            <button id="applyMixBtn">Apply</button>
          </div>
        </div>

        <div class="row" style="margin-top:8px;">
          <button id="randomCategoryBtn">üé≤ Random Category: OFF</button>
          <button id="reshuffleBtn">Shuffle</button>
        </div>

        <div class="divider"></div>

        <div class="row">
          <button id="matchModeBtn" class="primary">üèÅ Best of 10: OFF</button>
          <button id="newMatchBtn">New Match</button>
        </div>

        <div class="divider"></div>

        <div class="scoreGrid">
          <div class="scoreBox">
            <div class="scoreName" id="p1Label">Pauline</div>
            <div class="scoreNum" id="p1Score">0</div>
            <div class="tapHint">Award after ‚ÄúShow Answer‚Äù.</div>
          </div>
          <div class="scoreBox">
            <div class="scoreName" id="p2Label">Jon</div>
            <div class="scoreNum" id="p2Score">0</div>
            <div class="tapHint">Use ‚ÄúNo one‚Äù to skip.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="mini muted">
          <b>Keyboard (desktop)</b><br>
          <span class="kbd">n</span> next ‚Ä¢ <span class="kbd">a</span> answer ‚Ä¢ <span class="kbd">t</span> timer ‚Ä¢ <span class="kbd">b</span> buzzer
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const el = (id) => document.getElementById(id);

  // UI elements
  const catPill = el("catPill");
  const mixPill = el("mixPill");
  const matchPill = el("matchPill");
  const pointValuePill = el("pointValuePill");
  const qIndexEl = el("qIndex");
  const qTotalEl = el("qTotal");
  const turnNameEl = el("turnName");
  const questionText = el("questionText");

  const answerBox = el("answerBox");
  const answerText = el("answerText");
  const awardPointsLabel = el("awardPointsLabel");

  const nextBtn = el("nextBtn");
  const showAnsBtn = el("showAnsBtn");
  const toggleModeBtn = el("toggleModeBtn");
  const passBtn = el("passBtn");

  const p1NameInput = el("p1Name");
  const p2NameInput = el("p2Name");
  const p1Label = el("p1Label");
  const p2Label = el("p2Label");
  const p1ScoreEl = el("p1Score");
  const p2ScoreEl = el("p2Score");

  const awardP1 = el("awardP1");
  const awardP2 = el("awardP2");
  const awardNone = el("awardNone");

  const mixSelect = el("mixSelect");
  const applyMixBtn = el("applyMixBtn");
  const randomCategoryBtn = el("randomCategoryBtn");
  const reshuffleBtn = el("reshuffleBtn");
  const resetBtn = el("resetBtn");

  const timeLeftEl = el("timeLeft");
  const secondsInput = el("secondsInput");
  const startTimerBtn = el("startTimerBtn");
  const stopTimerBtn = el("stopTimerBtn");
  const buzzerBtn = el("buzzerBtn");

  const lightningBtn = el("lightningBtn");
  const forceLightningBtn = el("forceLightningBtn");

  const matchModeBtn = el("matchModeBtn");
  const newMatchBtn = el("newMatchBtn");
  const matchBanner = el("matchBanner");
  const matchStatus = el("matchStatus");

  const toastEl = el("toast");

  // Question bank (trimmed here for brevity‚Äîkeep your existing BANK/LIGHTNING_POOL)
  // Use your previous BANK + LIGHTNING_POOL exactly as-is:
  const BANK = [
    {cat:"90s", q:"What 1997 movie features the line: ‚ÄúI‚Äôm the king of the world!‚Äù?", a:"Titanic."},
    {cat:"Friends", q:"What‚Äôs the name of Ross‚Äôs pet monkey?", a:"Marcel."},
    {cat:"HIMYM", q:"What‚Äôs the name of the bar the gang hangs out at?", a:"MacLaren‚Äôs Pub."},
    {cat:"Random", q:"What planet is known as the Red Planet?", a:"Mars."},
    {cat:"Basic", q:"How many minutes are in an hour?", a:"60."},
    {cat:"Funny Facts", q:"What animal‚Äôs poop is cube-shaped?", a:"Wombat."},
    {cat:"Star Wars", q:"What is the name of Han Solo‚Äôs ship?", a:"The Millennium Falcon."},
    {cat:"Star Trek", q:"What species is known for assimilation and ‚ÄúWe are‚Ä¶‚Äù?", a:"The Borg."},
    {cat:"TV", q:"In Stranger Things, what is Eleven‚Äôs favorite food?", a:"Eggo waffles."},
    {cat:"Pop Culture", q:"What superhero is also known as the ‚ÄòDark Knight‚Äô?", a:"Batman."},
  ];

  const LIGHTNING_POOL = [
    {cat:"Lightning", q:"How many days are in a week?", a:"7."},
    {cat:"Lightning", q:"Finish: ‚ÄúMay the ____ be with you.‚Äù", a:"Force."},
    {cat:"Lightning", q:"What do you call frozen water?", a:"Ice."},
    {cat:"Lightning", q:"What is 12 + 8?", a:"20."},
  ];

  // Game state
  let mode = "turns";
  let randomCategory = false;
  let turn = 0;
  let score = [0,0];

  let activePool = [];
  let current = null;

  let questionNumber = 0;

  // Match mode
  let matchMode = false;
  const matchQuestionsTarget = 10;
  const matchWinScore = 6;
  let matchQuestionsAsked = 0;
  let matchLocked = false;

  // Lightning
  let lightningMode = false;
  let forceNextLightning = false;
  let currentPointValue = 1;

  // Timer
  let timer = { running:false, secondsLeft: 0, intervalId: null };

  // Helpers
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.style.display = "block";
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=> toastEl.style.display="none", 1400);
  }

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function clampSeconds(n){
    if (!Number.isFinite(n)) return 15;
    return Math.max(3, Math.min(120, Math.round(n)));
  }

  function getNames(){
    const p1 = (p1NameInput.value || "Player 1").trim();
    const p2 = (p2NameInput.value || "Player 2").trim();
    return [p1, p2];
  }

  function updateLabels(){
    const [p1, p2] = getNames();
    p1Label.textContent = p1;
    p2Label.textContent = p2;
    awardP1.textContent = p1;
    awardP2.textContent = p2;
    turnNameEl.textContent = (mode === "turns") ? (turn === 0 ? p1 : p2) : "Both";
  }

  function updateScores(){
    p1ScoreEl.textContent = String(score[0]);
    p2ScoreEl.textContent = String(score[1]);
  }

  function setMode(newMode){
    mode = newMode;
    toggleModeBtn.textContent = (mode === "turns") ? "Mode: Take Turns" : "Mode: Answer Same Time";
    passBtn.style.display = (mode === "turns") ? "inline-block" : "none";
    updateLabels();
  }

  function setPointValue(v){
    currentPointValue = v;
    pointValuePill.textContent = "Point: " + String(v);
    awardPointsLabel.textContent = String(v);
  }

  function prettyMixName(v){
    return (
      v === "all" ? "All" :
      v === "tv" ? "TV Shows" :
      v === "friends" ? "Friends" :
      v === "himym" ? "HIMYM" :
      v === "90s" ? "90s" :
      v === "pop" ? "Pop Culture" :
      v === "sw" ? "Star Wars" :
      v === "st" ? "Star Trek" :
      v === "random" ? "Random Facts" :
      v === "basic" ? "Basic Knowledge" :
      v === "funny" ? "Funny Facts" : "All"
    );
  }

  function filteredBank(){
    const mix = mixSelect.value;
    let cats = null;

    if (mix === "all") cats = ["90s","TV","Friends","HIMYM","Pop Culture","Star Wars","Star Trek","Random","Basic","Funny Facts"];
    else if (mix === "tv") cats = ["TV","Friends","HIMYM"];
    else if (mix === "friends") cats = ["Friends"];
    else if (mix === "himym") cats = ["HIMYM"];
    else if (mix === "90s") cats = ["90s"];
    else if (mix === "pop") cats = ["Pop Culture"];
    else if (mix === "sw") cats = ["Star Wars"];
    else if (mix === "st") cats = ["Star Trek"];
    else if (mix === "random") cats = ["Random"];
    else if (mix === "basic") cats = ["Basic"];
    else if (mix === "funny") cats = ["Funny Facts"];

    return BANK.filter(x => cats.includes(x.cat));
  }

  function applyMix(){
    stopTimer();
    mixPill.textContent = "Mix: " + prettyMixName(mixSelect.value);
    activePool = shuffle(filteredBank().slice());
    questionNumber = 0;
    current = null;

    questionText.textContent = "Press ‚ÄúNext Question‚Äù to begin.";
    catPill.textContent = "Category";
    answerBox.classList.add("hidden");
    qIndexEl.textContent = "0";
    qTotalEl.textContent = String(activePool.length);

    toast("Applied: " + prettyMixName(mixSelect.value));
  }

  function pickRandomCategoryFromPool(){
    const cats = Array.from(new Set(activePool.map(x => x.cat)));
    if (!cats.length) return null;
    return cats[Math.floor(Math.random()*cats.length)];
  }

  function maybePickLightning(){
    if (forceNextLightning){
      forceNextLightning = false;
      return true;
    }
    if (lightningMode && Math.random() < 0.20) return true;
    return false;
  }

  function nextQuestion(){
    if (matchMode && matchLocked){
      toast("Match over. Start New Match or turn it OFF.");
      return;
    }

    stopTimer();
    answerBox.classList.add("hidden");

    const doLightning = maybePickLightning();
    if (doLightning){
      setPointValue(2);
      current = LIGHTNING_POOL[Math.floor(Math.random()*LIGHTNING_POOL.length)];
      catPill.textContent = "‚ö° Lightning";
      questionText.textContent = current.q;
      timeLeftEl.textContent = "8";
      toast("Lightning! Worth 2 points ‚ö°");
    } else {
      setPointValue(1);

      if (activePool.length === 0){
        questionText.textContent = "No more questions in this mix. Change mix or Reset.";
        catPill.textContent = "Done";
        return;
      }

      if (randomCategory){
        const cat = pickRandomCategoryFromPool();
        const idxs = [];
        for (let i=0;i<activePool.length;i++) if (activePool[i].cat === cat) idxs.push(i);
        const pickIndex = idxs[Math.floor(Math.random()*idxs.length)];
        current = activePool.splice(pickIndex, 1)[0];
      } else {
        current = activePool.shift();
      }

      catPill.textContent = current.cat;
      questionText.textContent = current.q;

      const s = clampSeconds(Number(secondsInput.value || 15));
      timeLeftEl.textContent = String(s);
    }

    questionNumber++;
    qIndexEl.textContent = String(questionNumber);
    qTotalEl.textContent = String(questionNumber + activePool.length);

    if (matchMode){
      matchQuestionsAsked++;
      updateMatchUI();
    }

    updateLabels();
  }

  function showAnswer(){
    if (!current){ toast("Hit Next Question first üôÇ"); return; }
    answerText.textContent = current.a;
    answerBox.classList.remove("hidden");
  }

  // Timer + buzzer
  function beep(){
    try{
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioCtx();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "square";
      o.frequency.value = 220;
      g.gain.value = 0.12;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(()=>{ o.frequency.value = 140; }, 120);
      setTimeout(()=>{ o.stop(); ctx.close(); }, 320);
    } catch(e){}
  }

  function startTimer(){
    if (!current){ toast("Get a question first üôÇ"); return; }
    stopTimer();
    timer.secondsLeft = clampSeconds(Number(secondsInput.value || 15));
    timeLeftEl.textContent = String(timer.secondsLeft);
    timer.intervalId = setInterval(() => {
      timer.secondsLeft--;
      timeLeftEl.textContent = String(timer.secondsLeft);
      if (timer.secondsLeft <= 0){
        stopTimer();
        beep();
        toast("Time!");
      }
    }, 1000);
    toast("Timer started");
  }

  function stopTimer(){
    if (timer.intervalId) clearInterval(timer.intervalId);
    timer.intervalId = null;
  }

  function awardPoint(who){
    if (!current){ toast("No question active."); return; }
    const pts = currentPointValue || 1;
    const [p1, p2] = getNames();

    if (who === 0) score[0] += pts;
    else if (who === 1) score[1] += pts;

    updateScores();

    if (mode === "turns"){
      turn = (turn === 0) ? 1 : 0;
      updateLabels();
    }

    if (matchMode) checkMatchEnd(p1, p2);
  }

  function passTurn(){
    if (mode !== "turns") return;
    turn = (turn === 0) ? 1 : 0;
    updateLabels();
    toast("Turn passed");
  }

  function reshuffleRemaining(){
    activePool = shuffle(activePool);
    toast("Shuffled remaining questions");
  }

  // Match UI + end
  function updateMatchUI(){
    if (!matchMode){
      matchPill.textContent = "Match: OFF";
      matchBanner.classList.add("hidden");
      matchModeBtn.textContent = "üèÅ Best of 10: OFF";
      return;
    }
    matchPill.textContent = "Match: ON";
    matchBanner.classList.remove("hidden");
    matchModeBtn.textContent = "üèÅ Best of 10: ON";
    const remaining = Math.max(0, matchQuestionsTarget - matchQuestionsAsked);
    matchStatus.textContent = `Q ${matchQuestionsAsked}/${matchQuestionsTarget} ‚Ä¢ First to ${matchWinScore} ‚Ä¢ Remaining: ${remaining}`;
  }

  function checkMatchEnd(p1, p2){
    if (score[0] >= matchWinScore || score[1] >= matchWinScore){
      matchLocked = true;
      const winner = (score[0] > score[1]) ? p1 : p2;
      questionText.textContent = `üèÜ Match Over! Winner: ${winner}. Tap ‚ÄúNew Match‚Äù to play again.`;
      catPill.textContent = "Match Over";
      toast(`üèÜ ${winner} wins!`);
      return;
    }
    if (matchQuestionsAsked >= matchQuestionsTarget){
      matchLocked = true;
      let msg = "";
      if (score[0] > score[1]) msg = `üèÜ ${p1} wins!`;
      else if (score[1] > score[0]) msg = `üèÜ ${p2} wins!`;
      else msg = "ü§ù It‚Äôs a tie!";
      questionText.textContent = `üèÅ Best of 10 complete. ${msg} Tap ‚ÄúNew Match‚Äù to play again.`;
      catPill.textContent = "Match Over";
      toast(msg);
    }
  }

  function toggleMatchMode(){
    matchMode = !matchMode;
    matchLocked = false;
    matchQuestionsAsked = 0;
    updateMatchUI();
    toast(matchMode ? "Best of 10 ON" : "Best of 10 OFF");
  }

  function newMatch(){
    score = [0,0];
    matchMode = true;
    matchLocked = false;
    matchQuestionsAsked = 0;
    updateScores();
    updateMatchUI();
    applyMix();
    toast("New match started!");
  }

  function resetAll(){
    stopTimer();
    score = [0,0];
    turn = 0;
    randomCategory = false;
    lightningMode = false;
    forceNextLightning = false;
    matchMode = false;
    matchLocked = false;
    matchQuestionsAsked = 0;
    setMode("turns");
    setPointValue(1);
    randomCategoryBtn.textContent = "üé≤ Random Category: OFF";
    lightningBtn.textContent = "‚ö° Lightning Round: OFF";
    updateScores();
    updateMatchUI();
    applyMix();
    toast("Reset!");
  }

  // Events (THIS is what was breaking before)
  nextBtn.addEventListener("click", nextQuestion);
  showAnsBtn.addEventListener("click", showAnswer);
  toggleModeBtn.addEventListener("click", () => setMode(mode === "turns" ? "simul" : "turns"));
  passBtn.addEventListener("click", passTurn);

  awardP1.addEventListener("click", () => awardPoint(0));
  awardP2.addEventListener("click", () => awardPoint(1));
  awardNone.addEventListener("click", () => { toast("No point awarded"); if (matchMode) checkMatchEnd(...getNames()); });

  applyMixBtn.addEventListener("click", applyMix);

  randomCategoryBtn.addEventListener("click", () => {
    randomCategory = !randomCategory;
    randomCategoryBtn.textContent = randomCategory ? "üé≤ Random Category: ON" : "üé≤ Random Category: OFF";
    toast(randomCategory ? "Random category ON" : "Random category OFF");
  });

  reshuffleBtn.addEventListener("click", reshuffleRemaining);
  resetBtn.addEventListener("click", resetAll);

  startTimerBtn.addEventListener("click", startTimer);
  stopTimerBtn.addEventListener("click", () => { stopTimer(); toast("Timer stopped"); });
  buzzerBtn.addEventListener("click", () => { beep(); toast("Buzz!"); });

  secondsInput.addEventListener("change", () => {
    const s = clampSeconds(Number(secondsInput.value || 15));
    secondsInput.value = s;
    timeLeftEl.textContent = String(s);
  });

  lightningBtn.addEventListener("click", () => {
    lightningMode = !lightningMode;
    lightningBtn.textContent = lightningMode ? "‚ö° Lightning Round: ON" : "‚ö° Lightning Round: OFF";
    toast(lightningMode ? "Lightning mode ON" : "Lightning mode OFF");
  });

  forceLightningBtn.addEventListener("click", () => {
    forceNextLightning = true;
    toast("Next question will be ‚ö° Lightning (2 points)");
  });

  matchModeBtn.addEventListener("click", toggleMatchMode);
  newMatchBtn.addEventListener("click", newMatch);

  p1NameInput.addEventListener("input", updateLabels);
  p2NameInput.addEventListener("input", updateLabels);

  // Init
  setMode("turns");
  setPointValue(1);
  updateLabels();
  updateScores();
  applyMix();
})();
</script>
</body>
</html>